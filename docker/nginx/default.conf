server {
    listen 80;
    server_name localhost;
    root /var/www/symfony/public;

    # --- KLUCZOWA POPRAWKA A: Włączenie typów MIME (pozostaje) ---
    include /etc/nginx/mime.types;
    charset utf-8;
    # ----------------------------------------------------
    
    # 1. Główny blok routingu Symfony
    # Nginx próbuje znaleźć plik statyczny ($uri). Jeśli go nie ma,
    # przekazuje żądanie do /index.php (Front Controller Symfony).
    location / {
        try_files $uri /index.php$is_args$args;
    }

    location /build/ {
        root /var/www/symfony/public;
        access_log off;
    }

    # 2. Blok obsługujący PHP-FPM
    # Obsługuje żądania, które zostały przekierowane do index.php
    location ~ ^/index\.php(/|$) {
        # Jeśli plik nie istnieje, zwróć 404 (może być usunięte w prostych konfig.)
        # try_files $uri =404;
        
        fastcgi_pass php:9000;
        
        fastcgi_split_path_info ^(.+\.php)(/.*)$;
        include fastcgi_params;
        
        # Ustawia kluczową ścieżkę do pliku skryptu PHP
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        fastcgi_param PATH_INFO $fastcgi_path_info;

        # --- Zwiększenie limitów czasu (pozostaje) ---
        fastcgi_send_timeout 300;
        fastcgi_read_timeout 300;
        fastcgi_connect_timeout 300;
        # ----------------------------------------------------
    }

    # Blokada dostępu do prywatnych katalogów Symfony
    location ~ /\.env|/(bin|tests|migrations|var|vendor)/ {
        deny all;
    }
}